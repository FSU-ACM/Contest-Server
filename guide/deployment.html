<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deployment | Contest Server Suite</title>
    <meta name="description" content="For running Fall &amp; Spring Programming Contests">
    
    
    <link rel="preload" href="/Contest-Server/assets/css/styles.481bff7d.css" as="style"><link rel="preload" href="/Contest-Server/assets/js/app.481bff7d.js" as="script"><link rel="preload" href="/Contest-Server/assets/js/7.57f44325.js" as="script"><link rel="prefetch" href="/Contest-Server/assets/js/3.9a709e18.js"><link rel="prefetch" href="/Contest-Server/assets/css/1.styles.5a8ea794.css"><link rel="prefetch" href="/Contest-Server/assets/js/1.5a8ea794.js"><link rel="prefetch" href="/Contest-Server/assets/css/2.styles.a40b0877.css"><link rel="prefetch" href="/Contest-Server/assets/js/2.a40b0877.js"><link rel="prefetch" href="/Contest-Server/assets/js/4.96fc1405.js"><link rel="prefetch" href="/Contest-Server/assets/js/5.73e47db9.js"><link rel="prefetch" href="/Contest-Server/assets/js/6.a381539b.js"><link rel="prefetch" href="/Contest-Server/assets/js/8.d5f65ce0.js"><link rel="prefetch" href="/Contest-Server/assets/js/9.8c3b02ed.js">
    <link rel="stylesheet" href="/Contest-Server/assets/css/1.styles.5a8ea794.css"><link rel="stylesheet" href="/Contest-Server/assets/css/2.styles.a40b0877.css"><link rel="stylesheet" href="/Contest-Server/assets/css/styles.481bff7d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Contest-Server/" class="home-link router-link-active"><!----> <span class="site-name">Contest Server Suite</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Contest-Server/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Contest-Server/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/Contest-Server/contributing/" class="nav-link">Contributing</a></div> <a href="https://github.com/fsu-acm/contest-server" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Contest-Server/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Contest-Server/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/Contest-Server/contributing/" class="nav-link">Contributing</a></div> <a href="https://github.com/fsu-acm/contest-server" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Running the Software</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Contest-Server/guide/" class="sidebar-link">Introduction</a></li><li><a href="/Contest-Server/guide/getting_started.html" class="sidebar-link">Getting Started</a></li><li><a href="/Contest-Server/guide/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/Contest-Server/guide/deployment.html" class="active sidebar-link">Deployment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Contest-Server/guide/deployment.html#in-a-perfect-world" class="sidebar-link">In a Perfect World...</a></li><li class="sidebar-sub-header"><a href="/Contest-Server/guide/deployment.html#deploying-with-nginx" class="sidebar-link">Deploying with Nginx</a></li><li class="sidebar-sub-header"><a href="/Contest-Server/guide/deployment.html#common-issues" class="sidebar-link">Common Issues</a></li></ul></li><li><a href="/Contest-Server/guide/extra_credit.html" class="sidebar-link">Extra Credit</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="deployment"><a href="#deployment" aria-hidden="true" class="header-anchor">#</a> Deployment</h1> <p>Deploying this project should be as simple as the steps <a href="/Contest-Server/#easy-to-deploy">on the home page</a>, but in practice the suite can be much more finicky. Here we'll cover the details of deployment and steps to take to correct common problems.</p> <h2 id="in-a-perfect-world"><a href="#in-a-perfect-world" aria-hidden="true" class="header-anchor">#</a> In a Perfect World...</h2> <p>If you're deploying on a server whose Nginx configuration is already complete, redeploying the services should be as easily as follows (otherwise see <a href="#deploying-with-nginx">Deploying with Nginx</a>):</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Download the code</span>
<span class="token function">git</span> clone https://github.com/FSU-ACM/Contest-Server.git

<span class="token comment"># Copy in your config</span>
<span class="token function">cp</span> /your/docker/.env ./.env
<span class="token function">cp</span> /your/flask/production.py ./config/production.py

<span class="token comment"># Build the images</span>
docker-compose build

<span class="token comment"># Deploy the suite</span>
docker-compose up -d
</code></pre></div><p>If that doesn't work, you try can starting services individually in the following order. Where there are failures, consult the logs using <code>docker-compose logs -f &lt;service&gt;</code>.</p> <ol><li>Databases</li> <li>Servers</li> <li>Judgehosts</li></ol> <p>You can launch the services individually using:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Relevant flags: -d (detatch), --build</span>
docker-compose up <span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token operator">&lt;</span>service<span class="token operator">&gt;</span>
</code></pre></div><h2 id="deploying-with-nginx"><a href="#deploying-with-nginx" aria-hidden="true" class="header-anchor">#</a> Deploying with Nginx</h2> <p>On the Bastion server, we use Nginx to provide reverse proxying (connecting incoming web connections made to <code>bastion.cs.fsu.edu</code> to the correct service). Nginx requires configuration before use. Here's a rough overview of how to configure Nginx for deployment:</p> <h3 id="make-sure-nginx-is-installed"><a href="#make-sure-nginx-is-installed" aria-hidden="true" class="header-anchor">#</a> Make sure Nginx is installed</h3> <p>There are many guides for installing Nginx on a Linux server. Here's an abbreviated version:</p> <div class="language-sh extra-class"><pre class="language-text"><code>sudo apt-get update
sudo apt-get install -y nginx
</code></pre></div><h3 id="add-the-bastion-nginx-configuration"><a href="#add-the-bastion-nginx-configuration" aria-hidden="true" class="header-anchor">#</a> Add the Bastion Nginx configuration</h3> <p>In the repository, an Nginx configuration is saved at <code>/config/nginx/bastion.conf</code>. You should copy this into the Nginx configuration directory, probably located at <code>/etc/nginx/sites-available</code>.</p> <p>You also need to link the configuration so it's &quot;enabled&quot;:</p> <div class="language-sh extra-class"><pre class="language-text"><code>ln -s /etc/nginx/sites-available/bastion.conf /etc/nginx/sites-enabled/
</code></pre></div><p>You should also remove any other configurations in <code>sites-enabled/</code> unless you really know what you're doing.</p> <h3 id="configure-https-ssl-using-certbot"><a href="#configure-https-ssl-using-certbot" aria-hidden="true" class="header-anchor">#</a> Configure HTTPS/SSL using Certbot</h3> <p>Once the configuration is installed and linked, you should be able to access the webapp from <code>http://bastion.cs.fsu.edu</code>. Now follow the official Cerbot directions <a href="https://certbot.eff.org/lets-encrypt/ubuntuxenial-nginx" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to install Certbot and configure the domains.</p> <h3 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h3> <p>Once all is done, you will have configured SSL connections for the Webapp and Domserver services. This means that external connections on port 443 will be forwarded via HTTP (not HTTPS) to the servers running inside docker containers in their locally exposed ports.</p> <h2 id="common-issues"><a href="#common-issues" aria-hidden="true" class="header-anchor">#</a> Common Issues</h2> <h3 id="boot-order"><a href="#boot-order" aria-hidden="true" class="header-anchor">#</a> Boot Order</h3> <p>The Docker Compose configuration uses the <code>depends_on</code> settings to try and control the boot order. We do this because the servers can't launch without their respective databases. However, even with the databases launching beforehand, they might not be ready to receive connections by the time the servers come online.</p> <p>The Domserver has an explicitly defined loop to retry the MariaDB database until it becomes ready. However, the Flask webapp's behavior in the MongoEngine connection is not explicitly known to this project's maintainers at the time of writing this.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/fsu-acm/contest-server/edit/master/docs/guide/deployment.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Contest-Server/guide/configuration.html" class="prev">
          Configuration
        </a></span> <span class="next"><a href="/Contest-Server/guide/extra_credit.html">
          Extra Credit
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/Contest-Server/assets/js/7.57f44325.js" defer></script><script src="/Contest-Server/assets/js/app.481bff7d.js" defer></script>
  </body>
</html>
